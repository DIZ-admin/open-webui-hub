# üîß –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã Docling: UnboundLocalError df_osd

**–î–∞—Ç–∞:** 2025-06-21  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–µ—à–µ–Ω–æ  
**–í–µ—Ä—Å–∏—è Docling:** v0.15.0

## üìã –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### üî¥ –ò—Å—Ö–æ–¥–Ω–∞—è –æ—à–∏–±–∫–∞
```
UnboundLocalError: cannot access local variable 'df_osd' where it is not associated with a value
```

### üîç –ö–æ—Ä–µ–Ω—å –ø—Ä–æ–±–ª–µ–º—ã
–ê–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤ –ø–æ–∫–∞–∑–∞–ª, —á—Ç–æ –æ—à–∏–±–∫–∞ –≤—ã–∑–≤–∞–Ω–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ–º —Ñ–∞–π–ª–∞ `osd.traineddata` –¥–ª—è Tesseract OCR:

```
Error opening data file /usr/share/tesseract/tessdata/osd.traineddata
Please make sure the TESSDATA_PREFIX environment variable is set to your "tessdata" directory.
Failed loading language 'osd'
Tesseract couldn't load any languages!
Could not initialize tesseract.
```

### üìä –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
- **–í–µ—Ä—Å–∏—è –æ–±—Ä–∞–∑–∞:** `quay.io/docling-project/docling-serve:latest` (v0.15.0)
- **–î–∞—Ç–∞ –æ–±—Ä–∞–∑–∞:** 2025-06-17
- **–ü—Ä–æ–±–ª–µ–º–∞:** –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Ñ–∞–π–ª OSD (Orientation and Script Detection) –¥–ª—è Tesseract
- **–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏–µ:** –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è `df_osd` –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ UnboundLocalError

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### üîß –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–µ–¥–æ—Å—Ç–∞—é—â–µ–≥–æ —Ñ–∞–π–ª–∞
```bash
# –ó–∞–≥—Ä—É–∑–∫–∞ osd.traineddata –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker exec -u root open-webui-hub-docling-1 \
  wget -O /usr/share/tesseract/tessdata/osd.traineddata \
  https://github.com/tesseract-ocr/tessdata/raw/main/osd.traineddata
```

### üîß –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —Ñ–∞–π–ª–∞
docker exec open-webui-hub-docling-1 ls -la /usr/share/tesseract/tessdata/osd.traineddata

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ OSD –≤ Tesseract
docker exec open-webui-hub-docling-1 tesseract --list-langs
# –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å: eng, osd
```

### üîß –®–∞–≥ 3: –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è
–°–æ–∑–¥–∞–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π Dockerfile (`services/docling/Dockerfile`):

```dockerfile
FROM quay.io/docling-project/docling-serve:latest

USER root

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–µ–¥–æ—Å—Ç–∞—é—â–µ–≥–æ —Ñ–∞–π–ª–∞ osd.traineddata
RUN wget -O /usr/share/tesseract/tessdata/osd.traineddata \
    https://github.com/tesseract-ocr/tessdata/raw/main/osd.traineddata

USER 1001

LABEL version="v0.15.0-fixed"
```

### üîß –®–∞–≥ 4: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ docker-compose
```yaml
docling:
  build:
    context: ./services/docling
    dockerfile: Dockerfile
  image: openwebui-hub/docling:fixed
  # ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤
```
üöÄ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–≥–æ Docling —Å–µ—Ä–≤–∏—Å–∞
============================================================

‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è Docling: OK
‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ OSD –≤ Tesseract: OK  
‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ Docling: –ß–∏—Å—Ç—ã–µ, –æ—à–∏–±–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
‚úÖ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞: OK

üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã: 4/4 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—à–ª–∏
üéâ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ! Docling –∏—Å–ø—Ä–∞–≤–ª–µ–Ω.
```

### üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Open WebUI
- ‚úÖ Open WebUI –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Docling
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ `CONTENT_EXTRACTION_ENGINE=docling` –∞–∫—Ç–∏–≤–Ω–∞
- ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∞
- ‚úÖ –°–µ—Ä–≤–∏—Å –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ: Docling vs Tika

| –ö—Ä–∏—Ç–µ—Ä–∏–π | Docling (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π) | Tika |
|----------|------------------------|------|
| **–°—Ç–∞—Ç—É—Å** | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| **–§–æ—Ä–º–∞—Ç—ã** | PDF, DOCX, PPTX, HTML | –®–∏—Ä–æ–∫–∏–π —Å–ø–µ–∫—Ç—Ä |
| **OCR** | Tesseract + AI | Tesseract |
| **–ö–∞—á–µ—Å—Ç–≤–æ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è** | –í—ã—Å–æ–∫–æ–µ (AI-enhanced) | –•–æ—Ä–æ—à–µ–µ |
| **–°–∫–æ—Ä–æ—Å—Ç—å** | –°—Ä–µ–¥–Ω—è—è | –ë—ã—Å—Ç—Ä–∞—è |
| **–†–∞–∑–º–µ—Ä –æ–±—Ä–∞–∑–∞** | ~2GB | ~500MB |
| **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å** | ‚úÖ –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è | ‚úÖ –°—Ç–∞–±–∏–ª—å–Ω–∞—è |

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### üü¢ –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π Docling** –¥–ª—è –ª—É—á—à–µ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞
2. **–°–æ–±–µ—Ä–∏—Ç–µ –æ–±—Ä–∞–∑ –∑–∞—Ä–∞–Ω–µ–µ** –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
3. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –ª–æ–≥–∏** –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –Ω–æ–≤—ã—Ö –æ—à–∏–±–æ–∫

### üîÑ –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
1. **Tika –∫–∞–∫ fallback** - –æ—Å—Ç–∞–≤—å—Ç–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –±—ã—Å—Ç—Ä–æ–≥–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è
2. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `tests/test_docling_fixed.py`
3. **–†–µ–≥—É–ª—è—Ä–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è** - —Å–ª–µ–¥–∏—Ç–µ –∑–∞ –Ω–æ–≤—ã–º–∏ –≤–µ—Ä—Å–∏—è–º–∏ Docling

## üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –ë—ã—Å—Ç—Ä–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ (–≤—Ä–µ–º–µ–Ω–Ω–æ–µ)
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ñ–∞–π–ª–∞ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker exec -u root open-webui-hub-docling-1 \
  wget -O /usr/share/tesseract/tessdata/osd.traineddata \
  https://github.com/tesseract-ocr/tessdata/raw/main/osd.traineddata

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞
docker-compose -f compose.local.yml restart docling
```

### –ü–æ—Å—Ç–æ—è–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ
```bash
# –°–±–æ—Ä–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–≥–æ –æ–±—Ä–∞–∑–∞
docker-compose -f compose.local.yml build docling

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å –Ω–æ–≤—ã–º –æ–±—Ä–∞–∑–æ–º
docker-compose -f compose.local.yml up -d docling
```

## üìù –ó–∞–º–µ—Ç–∫–∏ –¥–ª—è –±—É–¥—É—â–∏—Ö –≤–µ—Ä—Å–∏–π

### ‚ö†Ô∏è –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
1. **–û–±–Ω–æ–≤–ª–µ–Ω–∏—è Docling** –º–æ–≥—É—Ç —Å–Ω–æ–≤–∞ —É–¥–∞–ª–∏—Ç—å osd.traineddata
2. **–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ Tesseract** –º–æ–≥—É—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å –¥—Ä—É–≥–∏—Ö —è–∑—ã–∫–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤
3. **–ù–æ–≤—ã–µ –≤–µ—Ä—Å–∏–∏** –º–æ–≥—É—Ç –∏—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É upstream

### üîÆ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- –°–ª–µ–¥–∏—Ç–µ –∑–∞ —Ä–µ–ª–∏–∑–∞–º–∏ Docling –Ω–∞ GitHub
- –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ª–æ–≥–∏ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
- –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [Docling GitHub](https://github.com/docling-project/docling-serve)
- [Tesseract OCR](https://github.com/tesseract-ocr/tesseract)
- [Tesseract traineddata](https://github.com/tesseract-ocr/tessdata)
- [Issue —Å osd.traineddata](https://github.com/tesseract-ocr/tesseract/issues/1133)

---
**–ê–≤—Ç–æ—Ä:** Augment Agent  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞, –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞  
**–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:** –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
